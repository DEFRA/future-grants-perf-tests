// Run below script in GAS and the CW mongosh terminal.
print("ðŸ” Starting scan and cleanup of test references...\n");

db.getCollectionNames().forEach((collection) => {
  // Skip system collections
  if (collection.startsWith("system.")) {
    return;
  }

  const cursor = db.getCollection(collection).find({
    $where: function () {
      const docStr = JSON.stringify(this);
      return docStr.includes("perf-test-client-ref") ||
             docStr.includes("frps-perf-test-client-ref") ||
             docStr.includes("client") ||
             docStr.includes("client-perf");
    }
  });

  let count = 0;

  cursor.forEach((doc) => {
    db.getCollection(collection).deleteOne({ _id: doc._id });
    print(`ðŸ—‘ï¸ Deleted from ${collection}: ${doc._id}`);
    count++;
  });

  if (count > 0) {
    print(`âœ… ${count} matching docs deleted from: ${collection}\n`);
  }
});

print("\nðŸŽ‰ Cleanup complete!");